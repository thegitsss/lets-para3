<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#0B2A4A">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Active Cases | Let<span class="gold">’</span>s-ParaConnect</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="manifest" href="site.webmanifest" />
  <link rel="mask-icon" href="maskable-icon.png" color="#0B2A4A" />

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@200&family=Cormorant+Garamond:wght@300;600&display=swap" rel="stylesheet" />
  <script src="assets/scripts/utils/session.js"></script>
  <style>
    .gold{color:#b4975a;}
    :root {
      --bg: #ffffff;
      --sidebar-bg: #f5f5f5e6;
      --accent: #b6a47a;
      --ink: #1a1a1a;
      --muted: #8a8a8a;
      --line: rgba(0,0,0,0.08);
      --panel: #fcfcfc;
      --radius: 14px;
      --font-serif: 'Cormorant Garamond', serif;
      --font-sans: 'Sarabun', sans-serif;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:var(--font-sans);
      font-weight:200;
      background:var(--bg);
      color:var(--ink);
      display:flex;
      min-height:100vh;
    }

    .sidebar{
      width:240px;
      background:var(--sidebar-bg);
      display:flex;
      flex-direction:column;
      border-right:1px solid var(--line);
      padding:24px 16px;
    }
    .logo{
      font-family:var(--font-serif);
      font-size:1.6rem;
      font-weight:300;
      text-align:center;
      margin-bottom:36px;
    }
    nav{display:flex;flex-direction:column;gap:14px;}
    nav a{
      text-decoration:none;
      color:var(--ink);
      font-size:0.95rem;
      padding:10px 14px;
      border-radius:var(--radius);
      transition:background .3s;
    }
    nav a.active,nav a:hover{background:rgba(0,0,0,0.04);}
    .sidebar-link{
      margin-top:1.5rem;
      width:100%;
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:0.6rem 1rem;
      background:transparent;
      font-size:0.9rem;
      font-family:var(--font-sans);
      cursor:pointer;
      transition:background .2s,color .2s;
    }
    .sidebar-link:hover,
    .sidebar-link:focus{
      background:rgba(0,0,0,0.05);
      color:var(--accent);
      outline:none;
    }
    .sidebar-footer{
      margin-top:auto;
      font-size:0.7rem;
      color:var(--muted);
      text-align:center;
    }
    .muted{color:var(--muted);}

    .main{
      flex:1;
      padding:40px;
      overflow-y:auto;
    }

    .topbar{
      display:flex;
      justify-content:flex-end;
      align-items:center;
      margin-bottom:2rem;
      gap:1.5rem;
    }

    .notification-icon {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      border: 1px solid var(--line);
      display: flex;
      justify-content: center;
      align-items: center;
      background: #fff;
      cursor: pointer;
      position: relative;
      transition: border-color 0.2s ease, transform 0.2s ease;
    }

    .notification-icon:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .notification-icon svg {
      width: 22px;
      height: 22px;
      color: var(--ink);
    }

    .notification-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #c0392b;
      color: #fff;
      font-size: 0.75rem;
      border-radius: 999px;
      padding: 2px 6px;
      line-height: 1;
      display: none;
      font-weight: 300;
    }

    .notification-badge.show {
      display: inline-flex;
    }

    header h1{
      font-family:var(--font-serif);
      font-weight:300;
      font-size:2.2rem;
      margin-bottom:0.25rem;
    }
    header p{font-weight:200;color:var(--muted);margin-bottom:2rem;}

    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1.5rem;
      flex-wrap:wrap;
      gap:1rem;
    }
    .page-header h2{
      font-family:var(--font-serif);
      font-weight:300;
      font-size:1.6rem;
    }
    .page-header .actions{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .page-header input[type="search"]{
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:6px;
      font-size:0.9rem;
      width:220px;
      transition:border-color .2s;
    }
    .page-header input[type="search"]:focus{border-color:var(--accent);outline:none;}
    .add-btn{
      background:var(--accent);
      color:#fff;
      font-family:Sarabun;
      font-weight:300;
      border:none;
      border-radius:6px;
      padding:9px 14px;
      cursor:pointer;
      font-size:0.9rem;
      transition:background .2s;
    }
    .add-btn:hover{background:#a0854d;}

    .filter-tabs{display:flex;gap:8px;margin-bottom:1.5rem;flex-wrap:wrap;}
    .filter-tab{
      padding:6px 14px;
      border-radius:20px;
      border:1px solid var(--line);
      background:#f7f8fa;
      color:var(--muted);
      font-size:.85rem;
      cursor:pointer;
      transition:all .2s;
    }
    .filter-tab.active{
      background:var(--accent);
      color:#fff;
      border-color:var(--accent);
    }

    table{
      width:100%;
      border-collapse:collapse;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,0.03);
    }
    th,td{
      text-align:left;
      padding:14px 16px;
      font-size:0.9rem;
      border-bottom:1px solid var(--line);
    }
    th{
      font-weight:300;
      color:var(--muted);
      background:#fafbfc;
    }
    td a{
      color:var(--ink);
      text-decoration:none;
      font-weight:200;
    }
    td a:hover{color:var(--accent);}
    .status{
      font-size:0.8rem;
      padding:3px 8px;
      border-radius:6px;
      font-weight:300;
      display:inline-flex;
      align-items:center;
    }
    .status.public{background:rgba(31,122,74,.1);color:#1f7a4a;}
    .status.private{background:rgba(176,71,71,.1);color:#b04747;}
    .status.pending{background:rgba(182,164,122,0.15);color:#7a5a1f;}
    .status.accepted{background:rgba(32,131,87,0.12);color:#1e6d45;}
    .status.declined{background:rgba(176,71,71,.12);color:#a93232;}
    .actions{text-align:right;}
    .case-actions {position:relative; display:inline-block;}
    .case-actions.open .case-menu {display:block;}
    .menu-trigger {
      background:none;
      border:none;
      color:var(--muted);
      font-size:1.1rem;
      padding:4px 6px;
      cursor:pointer;
      border-radius:6px;
      transition:color .2s, background .2s;
    }
    .menu-trigger:hover {color:var(--accent); background:rgba(0,0,0,0.03);}
    .case-menu {
      position:absolute;
      top:120%;
      right:0;
      background:#fff;
      border:1px solid var(--line);
      border-radius:10px;
      box-shadow:0 12px 24px rgba(0,0,0,0.12);
      display:none;
      min-width:200px;
      z-index:10;
    }
    .case-menu button {
      width:100%;
      border:none;
      background:none;
      text-align:left;
      padding:0.65rem 0.9rem;
      font-size:0.9rem;
      cursor:pointer;
      color:var(--ink);
      border-bottom:1px solid var(--line);
      transition:background .2s,color .2s;
    }
    .case-menu button:last-child {border-bottom:none;}
    .case-menu button:hover {background:rgba(182,164,122,0.1); color:var(--accent);}
    .case-menu .danger {color:#b04747;}
    .case-menu .danger:hover {color:#b04747;}
    .case-table.hidden {display:none;}
    .empty-row {
      text-align:center;
      color:var(--muted);
      font-style:italic;
    }
    .toast {
      position:fixed;
      left:50%;
      bottom:30px;
      transform:translate(-50%,20px);
      background:rgba(17,17,17,0.92);
      color:#fff;
      padding:0.85rem 1.25rem;
      border-radius:12px;
      font-size:0.9rem;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.25s ease, transform 0.25s ease;
      z-index:2000;
    }
    .toast.show {
      opacity:1;
      transform:translate(-50%,0);
    }
    .case-switcher{
      display:flex;
      flex-wrap:wrap;
      gap:0.6rem;
      margin:1.5rem 0 1rem;
    }
    .case-switcher button{
      background:#fff;
      border:1px solid var(--line);
      border-radius:999px;
      padding:0.45rem 1.2rem;
      font-size:0.9rem;
      color:var(--ink);
      cursor:pointer;
      transition:background 0.2s ease,color 0.2s ease,border-color 0.2s ease;
    }
    .case-switcher button.active{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }
    .hidden{display:none !important;}
    .case-files-pane{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:#fff;
      padding:1.5rem;
      margin-top:1.5rem;
    }
    .case-files-filters{
      display:flex;
      gap:.75rem;
      flex-wrap:wrap;
      margin-bottom:1.25rem;
    }
    .case-files-filters button{
      border:1px solid var(--line);
      border-radius:8px;
      padding:0.5rem 1rem;
      cursor:pointer;
      background:#fff;
      font-size:0.9rem;
      transition:all .2s ease;
    }
    .case-files-filters button.active{
      background:var(--accent);
      color:#fff;
      border-color:var(--accent);
    }
    .case-files-empty{
      padding:1rem;
      color:var(--muted);
      font-size:0.95rem;
    }
    .case-files-grid{
      display:flex;
      flex-direction:column;
      gap:1rem;
    }
    .case-files-grid .file-card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:#fff;
      padding:1rem 1.25rem;
      display:flex;
      flex-direction:column;
      gap:.6rem;
    }
    .case-files-grid .file-line{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
    }
    .case-files-grid .file-name{
      font-family:var(--font-serif);
      font-size:1.05rem;
      word-break:break-word;
    }
    .case-files-grid .file-status{
      font-size:.85rem;
      font-weight:600;
      color:var(--accent);
      text-transform:capitalize;
    }
    .case-files-grid .file-meta{
      display:flex;
      gap:1rem;
      font-size:.85rem;
      color:var(--muted);
      flex-wrap:wrap;
    }
    .case-files-grid .file-actions{
      display:flex;
      gap:.75rem;
      flex-wrap:wrap;
    }
    .note-cell{
      max-width:260px;
      font-size:0.85rem;
      color:var(--muted);
    }
    .note-cell .note-preview{margin-bottom:0.25rem;}
    .note-cell .note-edit-btn{
      border:none;
      background:none;
      color:var(--accent);
      font-size:0.8rem;
      cursor:pointer;
      padding:0;
    }
    .note-cell .note-edit-btn:hover{text-decoration:underline;}
    .note-modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.35);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:3000;
    }
    .note-modal.hidden{display:none;}
    .note-modal-card{
      background:#fff;
      border-radius:12px;
      padding:1.25rem;
      width:min(90vw,440px);
      box-shadow:0 30px 80px rgba(15,23,42,0.25);
      display:flex;
      flex-direction:column;
      gap:0.85rem;
    }
    .note-modal-card textarea{
      min-height:140px;
      border:1px solid var(--line);
      border-radius:10px;
      padding:0.75rem;
      resize:vertical;
      font-family:inherit;
      font-size:0.95rem;
    }
    .note-modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:0.75rem;
      flex-wrap:wrap;
    }
    .btn{
      border-radius:999px;
      padding:0.55rem 1.4rem;
      border:1px solid transparent;
      font-family:inherit;
      font-size:0.9rem;
      cursor:pointer;
      transition:background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }
    .btn.primary{background:var(--accent);color:#fff;}
    .btn.primary:hover{background:#9a8459;}
    .btn.secondary{
      background:#fff;
      border:1px solid var(--line);
      color:var(--ink);
    }
    .btn.secondary:hover{border-color:var(--accent);color:var(--accent);}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="logo">Dashboard</div>
    <nav>
      <a href="dashboard-attorney.html">Home</a>
      <a href="active-cases.html" class="active">Cases &amp; Files</a>
      <a href="billing-attorney.html">Escrow</a>
      <a href="help.html">Help</a>
    </nav>
    <button type="button" class="sidebar-link" id="logoutBtn">Log Out</button>
    <div class="sidebar-footer">© Let’s‑ParaConnect 2025</div>
  </aside>

  <main class="main">
    <div class="topbar" data-attorney-header></div>

    <header>
      <h1>Active Cases</h1>
      <p>Manage and monitor your open matters below.</p>
    </header>
    <div class="case-switcher" role="tablist" aria-label="Case views">
      <button type="button" class="active" data-case-view="cases" role="tab" aria-selected="true">Cases</button>
      <button type="button" data-case-view="files" role="tab" aria-selected="false">Case Files</button>
    </div>

    <section id="casesViewSection">
      <div class="page-header">
        <h2>All Active Cases</h2>
        <div class="actions">
          <input type="search" placeholder="Search cases..." data-cases-search />
          <button class="add-btn" type="button" data-case-quick="create">＋ New Case</button>
        </div>
      </div>

      <div class="filter-tabs">
        <button class="filter-tab active" data-case-filter="active">Active (<span data-case-count="active">0</span>)</button>
        <button class="filter-tab" data-case-filter="draft">Draft (<span data-case-count="draft">0</span>)</button>
        <button class="filter-tab" data-case-filter="archived">Archived (<span data-case-count="archived">0</span>)</button>
        <button class="filter-tab" data-case-filter="inquiries">Inquiries (<span data-case-count="inquiries">0</span>)</button>
      </div>

      <div data-cases-wrapper>
        <div class="case-table" data-case-table="active">
          <table>
            <thead>
            <tr>
              <th>Title</th>
              <th>Client</th>
              <th>Specialty</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Posted</th>
              <th class="actions"></th>
            </tr>
          </thead>
          <tbody data-table-body="active">
            <tr><td colspan="7" class="empty-row">Loading cases…</td></tr>
          </tbody>
        </table>
        </div>

        <div class="case-table hidden" data-case-table="draft">
          <table>
            <thead>
            <tr>
              <th>Title</th>
              <th>Client</th>
              <th>Specialty</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Last Edited</th>
              <th class="actions"></th>
            </tr>
          </thead>
          <tbody data-table-body="draft">
            <tr><td colspan="7" class="empty-row">Loading draft cases…</td></tr>
          </tbody>
        </table>
        </div>

        <div class="case-table hidden" data-case-table="archived">
          <table>
            <thead>
            <tr>
              <th>Title</th>
              <th>Client</th>
              <th>Specialty</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Archived</th>
              <th class="actions"></th>
            </tr>
          </thead>
          <tbody data-table-body="archived">
            <tr><td colspan="7" class="empty-row">Loading archived cases…</td></tr>
          </tbody>
        </table>
        </div>

        <div class="case-table hidden" data-case-table="inquiries">
          <table>
            <thead>
            <tr>
              <th>Title</th>
              <th>Client</th>
              <th>Specialty</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Posted</th>
              <th class="actions"></th>
            </tr>
          </thead>
          <tbody data-table-body="inquiries">
            <tr><td colspan="7" class="empty-row">Loading inquiries…</td></tr>
          </tbody>
        </table>
        </div>
      </div>
    </section>

    <section id="caseFilesSection" class="case-files-pane hidden" aria-labelledby="caseFilesHeading">
      <div class="page-header">
        <div>
          <h2 id="caseFilesHeading">Case Files</h2>
          <p>Review uploaded work, download approved files, or request revisions.</p>
        </div>
      </div>
      <div class="case-files-filters">
        <button type="button" id="caseFilesEmbedFilterAll" class="active">All Files</button>
        <button type="button" id="caseFilesEmbedFilterApproved">Approved</button>
        <button type="button" id="caseFilesEmbedFilterPending">Awaiting Review</button>
        <button type="button" id="caseFilesEmbedFilterRevisions">Revisions Requested</button>
      </div>
      <div class="case-files-grid" id="caseFilesEmbedContainer">
        <p class="case-files-empty">Loading files…</p>
      </div>
    </section>
  </main>
  <div id="caseNoteModal" class="note-modal hidden" role="dialog" aria-modal="true">
    <div class="note-modal-card">
      <h3 style="font-family:var(--font-serif);font-weight:300;">Edit Case Note</h3>
      <textarea id="caseNoteTextarea" placeholder="Add internal notes for this case."></textarea>
      <div class="note-modal-actions">
        <button type="button" class="btn secondary" data-note-cancel>Cancel</button>
        <button type="button" class="btn primary" data-note-save>Save Note</button>
      </div>
    </div>
  </div>

  <div id="toastBanner" class="toast" role="status" aria-live="polite"></div>
  <script>
    window.__ATTORNEY_PAGE__ = "cases";
  </script>
  <script src="assets/scripts/utils/toast.js"></script>
  <script type="module" src="assets/scripts/attorney-tabs.js"></script>
  <script type="module">
    import { initCaseFilesView } from "./assets/scripts/case-files-view.js";

    document.addEventListener("DOMContentLoaded", () => {
      const viewButtons = document.querySelectorAll("[data-case-view]");
      const sections = {
        cases: document.getElementById("casesViewSection"),
        files: document.getElementById("caseFilesSection"),
      };
      let filesReady = false;

      viewButtons.forEach((btn) => {
        btn.addEventListener("click", async () => {
          const targetView = btn.dataset.caseView;
          if (!targetView || btn.classList.contains("active")) return;
          viewButtons.forEach((node) => {
            const isActive = node === btn;
            node.classList.toggle("active", isActive);
            node.setAttribute("aria-selected", isActive ? "true" : "false");
          });
          Object.entries(sections).forEach(([key, node]) => {
            if (!node) return;
            node.classList.toggle("hidden", key !== targetView);
          });
          if (targetView === "files" && !filesReady) {
            filesReady = true;
            await initCaseFilesView({
              containerId: "caseFilesEmbedContainer",
              filters: [
                { id: "caseFilesEmbedFilterAll", fn: (files) => files },
                { id: "caseFilesEmbedFilterApproved", fn: (files) => files.filter((f) => f.status === "approved") },
                { id: "caseFilesEmbedFilterPending", fn: (files) => files.filter((f) => f.status === "pending_review") },
                { id: "caseFilesEmbedFilterRevisions", fn: (files) => files.filter((f) => f.status === "attorney_revision") },
              ],
              emptyCopy: "Awaiting paralegal submissions.",
              emptySubtext: "Once files arrive, they’ll show up here automatically.",
              unauthorizedCopy: "You need an attorney account to view these files.",
            });
          }
        });
      });
    });
  </script>
</body>
</html>
