<!DOCTYPE html>
<html lang="en">
<head>

  <link rel="stylesheet" href="assets/styles/fonts.css" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#0B2A4A">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Case Invoices – Let’s-ParaConnect</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="manifest" href="site.webmanifest" />
  <link rel="mask-icon" href="maskable-icon.png" color="#0B2A4A" />

  <style>
    .skip-link {
      position: absolute;
      left: 12px;
      top: -40px;
      background: #1a2230;
      color: #ffffff;
      padding: 8px 12px;
      border-radius: 6px;
      text-decoration: none;
      z-index: 10000;
      font-size: 14px;
    }

    .skip-link:focus {
      top: 12px;
    }

    .gold{color:#b4975a;}
    :root {
      --bg:#ffffff;
      --sidebar-bg:#f5f5f5e6;
      --panel:#fcfcfc;
      --accent:#b6a47a;
      --ink:#1a1a1a;
      --muted:#8a8a8a;
      --line:rgba(0,0,0,0.08);
      --radius:14px;
      --font-serif:'Cormorant Garamond',serif;
      --font-sans:'Sarabun',sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{display:flex;font-family:var(--font-sans);color:var(--ink);background:var(--bg);min-height:100vh;}

    .sidebar{width:240px;background:var(--sidebar-bg);display:flex;flex-direction:column;border-right:1px solid var(--line);padding:24px 16px;}
    .logo{font-family:var(--font-serif);font-size:1.6rem;font-weight:300;text-align:center;margin-bottom:36px;}
    nav{display:flex;flex-direction:column;gap:14px;}
    nav a{text-decoration:none;color:var(--ink);font-weight:200;font-size:.95rem;padding:10px 14px;border-radius:var(--radius);transition:background .3s;}
    nav a.active,nav a:hover{background:rgba(0,0,0,0.04);}
    .sidebar-link{
      margin-top:1.5rem;
      width:100%;
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:0.6rem 1rem;
      background:transparent;
      font-size:0.9rem;
      font-family:var(--font-sans);
      cursor:pointer;
      transition:background .2s,color .2s;
    }
    .sidebar-link:hover,
    .sidebar-link:focus{
      background:rgba(0,0,0,0.05);
      color:var(--accent);
      outline:none;
    }

    .main{flex:1;padding:40px;overflow-y:auto;}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;}
    .filters{display:flex;gap:.75rem;flex-wrap:wrap;margin-bottom:1rem;}
    .filter-btn{border:1px solid var(--line);border-radius:8px;padding:.45rem 1rem;background:#fff;cursor:pointer;font-size:.9rem;transition:all .2s;}
    .filter-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}

    .actions-row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1rem;}
    .actions-row input{border:1px solid var(--line);border-radius:8px;padding:.45rem .8rem;min-width:220px;}
    .actions-row select{border:1px solid var(--line);border-radius:8px;padding:.45rem .8rem;}

    .more-actions{position:relative;}
    .more-trigger{border:1px solid var(--line);border-radius:8px;padding:.45rem 1rem;background:#fff;cursor:pointer;}
    .more-menu{display:none;position:absolute;right:0;top:110%;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.12);width:180px;z-index:30;}
    .more-menu button{width:100%;border:none;background:none;text-align:left;padding:.6rem .9rem;cursor:pointer;font-size:.9rem;}
    .more-menu button:hover{background:rgba(0,0,0,0.05);}
    .more-actions.open .more-menu{display:block;}

    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--line);border-radius:14px;overflow:hidden;}
    thead{background:var(--panel);}
    th,td{padding:.75rem 1rem;border-bottom:1px solid var(--line);font-size:.9rem;text-align:left;}
    th{cursor:pointer;color:var(--muted);font-weight:300;}
    tr:hover td{background:rgba(182,164,122,0.08);}
    tbody tr:last-child td{border-bottom:none;}
    .invoice-link{color:var(--accent);cursor:pointer;text-decoration:none;font-weight:500;}

    .totals-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1.5rem;}
    .total-card{border:1px solid var(--line);border-radius:12px;padding:1rem;background:var(--panel);}
    .total-card h4{font-family:var(--font-serif);margin-bottom:.3rem;font-size:1rem;}
    .total-card p{font-size:1.2rem;font-weight:500;}

    .pagination{display:flex;justify-content:flex-end;align-items:center;gap:.75rem;margin-top:1rem;font-size:.9rem;color:var(--muted);}
    .pager-btn{border:1px solid var(--line);border-radius:6px;background:#fff;padding:.35rem .65rem;cursor:pointer;}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:100;}
    .modal-content{background:#fff;border-radius:12px;padding:1rem;width:min(90vw,900px);height:min(90vh,600px);display:flex;flex-direction:column;}
    .modal-content header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;}
    .modal iframe{flex:1;border:none;border:1px solid var(--line);border-radius:8px;}
    .sidebar-bottom{margin-top:auto;display:flex;flex-direction:column;gap:12px;}
    .sidebar-footer{font-size:.7rem;color:var(--muted);text-align:center;}

    @media(max-width:900px){
      body{flex-direction:column;}
      .sidebar{width:100%;flex-direction:column;align-items:center;gap:12px;}
      .sidebar nav{width:100%;flex-direction:row;flex-wrap:wrap;justify-content:center;}
      .sidebar nav a{flex:1 1 120px;text-align:center;}
      .main{padding:24px;}
      table{font-size:.85rem;}
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>
  <aside class="sidebar">
    <div class="logo">Dashboard</div>
    <nav>
      <a href="dashboard-attorney.html">Home</a>
      <a href="dashboard-attorney.html#cases" class="active">Cases &amp; Files</a>
      <a href="dashboard-attorney.html#billing">Escrow</a>
      <a href="help.html">Help</a>
    </nav>
    <div class="sidebar-bottom">
      <button type="button" class="sidebar-link" id="logoutBtn">Log Out</button>
      <div class="sidebar-footer"><a href="index.html" style="color:inherit;text-decoration:none;">© Let’s-ParaConnect 2025</a></div>
    </div>
  </aside>

  <main id="main" tabindex="-1" class="main">
    <div class="topbar">
      <h1 style="font-family:var(--font-serif);font-weight:300;font-size:2rem;">Case Invoices</h1>
      <div class="more-actions" id="moreActions">
        <button class="more-trigger" type="button" aria-haspopup="menu" aria-expanded="false" aria-controls="caseInvoicesMenu">More Actions ▾</button>
        <div class="more-menu" id="caseInvoicesMenu">
          <button onclick="downloadAll()">Download All</button>
          <button onclick="exportCsv()">Export CSV</button>
          <button onclick="emailSummary()">Email Summary</button>
        </div>
      </div>
    </div>

    <div class="filters">
      <button class="filter-btn active" data-status="unpaid">Unpaid</button>
      <button class="filter-btn" data-status="paid">Fully Paid & Written Off</button>
    </div>

    <div class="actions-row">
      <input type="search" id="searchInput" placeholder="Search invoices or cases..." aria-label="Search invoices or cases" />
      <select id="itemsPerPage" disabled>
        <option>Items per page: 100</option>
      </select>
    </div>

    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th data-sort="invoiceNo">Invoice No.</th>
            <th data-sort="createdOn">Created On</th>
            <th data-sort="caseName">Case Name</th>
            <th data-sort="invoiceAmt">Invoice Amt</th>
            <th data-sort="due">Due</th>
            <th data-sort="overdue">Overdue</th>
            <th data-sort="final">Final</th>
          </tr>
        </thead>
        <tbody id="invoiceBody"></tbody>
      </table>
    </div>

    <div class="totals-row">
      <div class="total-card"><h4>Total Invoiced</h4><p id="totalInvoiced">$0.00</p></div>
      <div class="total-card"><h4>Total Received</h4><p id="totalReceived">$0.00</p></div>
      <div class="total-card"><h4>Total Written Off</h4><p id="totalWrittenOff">$0.00</p></div>
      <div class="total-card"><h4>Total Unpaid</h4><p id="totalUnpaid">$0.00</p></div>
    </div>

    <div class="pagination">
      <span>Page 1 of 1</span>
      <div>
        <button class="pager-btn" disabled>&lt;</button>
        <button class="pager-btn" disabled>&gt;</button>
      </div>
    </div>
  </main>

  <div class="modal" id="invoiceModal">
    <div class="modal-content">
      <header>
        <h3 id="modalTitle">Invoice</h3>
        <button class="pager-btn" onclick="closeModal()" aria-label="Close invoice details">✕</button>
      </header>
      <iframe id="invoiceFrame" src=""></iframe>
    </div>
  </div>

  <script type="module" src="assets/scripts/auth.js"></script>
  <script>
    const invoiceData=[
      {invoiceNo:'INV-2025-001', createdOn:'2025-11-08', caseName:'Motion for Summary Judgment', invoiceAmt:3200, due:'2025-12-08', overdue:0, final:'No', status:'unpaid', received:0, writtenOff:0, pdf:'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'},
      {invoiceNo:'INV-2025-002', createdOn:'2025-11-01', caseName:'Anderson Merger Filing', invoiceAmt:4800, due:'2025-12-01', overdue:10, final:'No', status:'unpaid', received:1200, writtenOff:0, pdf:'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'},
      {invoiceNo:'INV-2025-003', createdOn:'2025-10-20', caseName:'Hamilton & Ross', invoiceAmt:2100, due:'2025-11-20', overdue:0, final:'Yes', status:'paid', received:2100, writtenOff:0, pdf:'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'},
      {invoiceNo:'INV-2025-004', createdOn:'2025-09-30', caseName:'Brightpath LLC', invoiceAmt:3115, due:'2025-10-30', overdue:15, final:'No', status:'paid', received:2500, writtenOff:615, pdf:'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'}
    ];

    let statusFilter='unpaid';
    let searchTerm='';
    let sortKey='createdOn';
    let sortDir='desc';

    const tbody=document.getElementById('invoiceBody');

    function renderTable(){
      const filtered=invoiceData.filter(inv=>{
        const matchesStatus=statusFilter==='paid'? inv.status==='paid' : inv.status!=='paid';
        const matchesSearch=inv.invoiceNo.toLowerCase().includes(searchTerm)||inv.caseName.toLowerCase().includes(searchTerm);
        return matchesStatus && matchesSearch;
      }).sort((a,b)=>{
        let valA=a[sortKey];
        let valB=b[sortKey];
        if(sortKey==='invoiceAmt'){ return sortDir==='asc'? valA-valB : valB-valA; }
        if(sortKey==='createdOn'||sortKey==='due'){ return sortDir==='asc'? new Date(valA)-new Date(valB) : new Date(valB)-new Date(valA); }
        return sortDir==='asc'? String(valA).localeCompare(String(valB)) : String(valB).localeCompare(String(valA));
      });

      tbody.innerHTML='';
      filtered.forEach(inv=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td><a class="invoice-link" href="#" onclick="openInvoice('${inv.invoiceNo}'); return false;">${inv.invoiceNo}</a></td>
          <td>${inv.createdOn}</td>
          <td>${inv.caseName}</td>
          <td>$${inv.invoiceAmt.toLocaleString()}</td>
          <td>${inv.due}</td>
          <td>${inv.overdue || 0} days</td>
          <td>${inv.final}</td>`;
        tbody.appendChild(tr);
      });
      updateTotals(filtered);
    }

    function updateTotals(rows){
      const totalInvoiced=rows.reduce((sum,r)=>sum+r.invoiceAmt,0);
      const totalReceived=rows.reduce((sum,r)=>sum+r.received,0);
      const totalWritten=rows.reduce((sum,r)=>sum+r.writtenOff,0);
      const totalUnpaid=rows.reduce((sum,r)=>sum+(r.invoiceAmt-r.received-r.writtenOff),0);
      document.getElementById('totalInvoiced').textContent=`$${totalInvoiced.toLocaleString()}`;
      document.getElementById('totalReceived').textContent=`$${totalReceived.toLocaleString()}`;
      document.getElementById('totalWrittenOff').textContent=`$${totalWritten.toLocaleString()}`;
      document.getElementById('totalUnpaid').textContent=`$${totalUnpaid.toLocaleString()}`;
    }

    document.querySelectorAll('.filter-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        statusFilter=btn.dataset.status;
        renderTable();
      });
    });

    document.getElementById('searchInput').addEventListener('input',e=>{
      searchTerm=e.target.value.toLowerCase();
      renderTable();
    });

    document.querySelectorAll('th').forEach(th=>{
      th.addEventListener('click',()=>{
        const key=th.dataset.sort;
        if(!key) return;
        if(sortKey===key){ sortDir=sortDir==='asc'?'desc':'asc'; }
        else{ sortKey=key; sortDir='asc'; }
        renderTable();
      });
    });

    const moreActions=document.getElementById('moreActions');
    const moreTrigger=moreActions?.querySelector('.more-trigger');

    function closeMoreActions({ returnFocus = false } = {}) {
      if (!moreActions) return;
      moreActions.classList.remove('open');
      if (moreTrigger) moreTrigger.setAttribute('aria-expanded', 'false');
      if (returnFocus && moreTrigger) moreTrigger.focus();
    }

    document.addEventListener('click',e=>{
      if (!moreActions) return;
      if(moreActions.contains(e.target)) {
        const willOpen = !moreActions.classList.contains('open');
        closeMoreActions();
        if (willOpen) {
          moreActions.classList.add('open');
          if (moreTrigger) moreTrigger.setAttribute('aria-expanded', 'true');
        }
      } else {
        closeMoreActions();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMoreActions({ returnFocus: true });
      }
    });

    function downloadAll(){alert('Preparing invoice PDF bundle...');}
    function exportCsv(){alert('CSV export generated.');}
    function emailSummary(){alert('Summary emailed to client.');}

    function openInvoice(invoiceNo){
      const invoice=invoiceData.find(i=>i.invoiceNo===invoiceNo);
      if(!invoice) return;
      document.getElementById('modalTitle').textContent=`Invoice ${invoice.invoiceNo}`;
      document.getElementById('invoiceFrame').src=invoice.pdf;
      document.getElementById('invoiceModal').style.display='flex';
    }
    function closeModal(){
      document.getElementById('invoiceModal').style.display='none';
      document.getElementById('invoiceFrame').src='';
    }

    renderTable();
  </script>
</body>
</html>
