<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#0B2A4A">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Case – Let’s-ParaConnect</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="manifest" href="site.webmanifest" />
  <link rel="mask-icon" href="maskable-icon.png" color="#0B2A4A" />

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@200&family=Cormorant+Garamond:wght@300;600&display=swap" rel="stylesheet" />
  <script src="assets/scripts/utils/session.js"></script>
  <style>
    .gold{color:#b4975a;}
    :root {
      --bg:#ffffff;
      --sidebar-bg:#f5f5f5e6;
      --accent:#b6a47a;
      --ink:#1a1a1a;
      --muted:#8a8a8a;
      --line:rgba(0,0,0,0.08);
      --panel:#fcfcfc;
      --sidebar-text:#1a1a1a;
      --radius:14px;
      --font-serif:'Cormorant Garamond',serif;
      --font-sans:'Sarabun',sans-serif;
    }
    body.theme-dark{
      --bg:#0f172a;
      --sidebar-bg:#1c2333;
      --panel:#151b29;
      --ink:#f5f6fb;
      --muted:#9aa7c4;
      --line:rgba(255,255,255,0.08);
      --sidebar-text:#f8fbff;
    }
    body.theme-mountain{
      --bg:#f8f6f1;
      --panel:#ffffff;
      --muted:#7a736a;
      --sidebar-text:#ffffff;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Sarabun',serif;
      background:var(--bg);
      color:var(--ink);
      display:flex;
      height:100vh;
      overflow:hidden;
      font-weight:200;
    }

    /* Sidebar */
    .sidebar{
      width:240px;
      background:var(--sidebar-bg);
      display:flex;
      flex-direction:column;
      border-right:1px solid var(--line);
      padding:24px 16px;
      color:var(--sidebar-text);
      position:relative;
    }
    .sidebar::before{
      content:"";
      position:absolute;
      inset:0;
      background:transparent;
      pointer-events:none;
      transition:background .3s ease;
    }
    body.theme-mountain .sidebar{
      background:url('hero-mountain.jpg') center/cover no-repeat;
    }
    body.theme-mountain .sidebar::before{
      background:rgba(0,0,0,0.45);
    }
    body.theme-mountain .sidebar > *{
      position:relative;
      z-index:1;
    }
    .logo{
      font-family:var(--font-serif);
      font-size:1.6rem;
      font-weight:300;
      text-align:center;
      margin-bottom:36px;
    }
    nav{display:flex;flex-direction:column;gap:14px;}
    nav a{
      text-decoration:none;
      color:var(--sidebar-text);
      font-size:0.95rem;
      padding:10px 14px;
      border-radius:var(--radius);
      transition:background .3s;
    }
    nav a.active,nav a:hover{background:rgba(0,0,0,0.04);}
    body.theme-dark nav a.active,
    body.theme-dark nav a:hover{background:rgba(255,255,255,0.12);}
    body.theme-mountain nav a.active,
    body.theme-mountain nav a:hover{background:rgba(255,255,255,0.18);}
    body.theme-mountain nav a{color:#fff;}
    .sidebar-link{
      margin-top:1.5rem;
      width:100%;
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:0.6rem 1rem;
      background:transparent;
      font-size:0.9rem;
      font-family:var(--font-sans);
      color:var(--sidebar-text);
      cursor:pointer;
      transition:background .2s,color .2s;
    }
    .sidebar-link:hover,
    .sidebar-link:focus{
      background:rgba(0,0,0,0.05);
      color:var(--accent);
      outline:none;
    }
    body.theme-dark .sidebar-link:hover,
    body.theme-dark .sidebar-link:focus,
    body.theme-mountain .sidebar-link:hover,
    body.theme-mountain .sidebar-link:focus{
      color:#fff;
    }
    body.theme-mountain .sidebar-link{color:#fff;}
    .sidebar-footer{
      margin-top:auto;
      font-size:0.7rem;
      color:var(--muted);
      text-align:center;
    }
    /* uniform style for step bubbles across all create-case pages */
.steps {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 700px;
  margin: 0 auto 2.5rem;
  position: relative;
}

.steps::before {
  content: "";
  position: absolute;
  top: 14px;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--line);
}

.step {
  text-align: center;
  flex: 1;
  position: relative;
}

.circle {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid var(--line);
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 8px;
  font-size: 0.8rem;
  color: var(--muted);
  transition: all 0.3s ease;
}

.step.active .circle {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}

.step span {
  font-size: 0.85rem;
  color: var(--muted);
}

    /* Main */
    .main{flex:1;padding:40px;overflow-y:auto;}
    .topbar{display:flex;justify-content:flex-end;align-items:flex-start;margin-bottom:2rem;gap:1.5rem;position:relative;}
    .notification-icon{width:46px;height:46px;border-radius:50%;border:1px solid var(--line);display:flex;justify-content:center;align-items:center;background:#fff;cursor:pointer;position:relative;transition:border-color .2s ease, transform .2s ease;}
    .notification-icon:hover{border-color:var(--accent);transform:translateY(-1px);}
    .notification-icon svg{width:22px;height:22px;color:var(--ink);}
    .notification-badge{position:absolute;top:-4px;right:-4px;background:#c0392b;color:#fff;border-radius:999px;font-size:.75rem;padding:2px 6px;line-height:1;display:none;font-weight:600;}
    .notification-badge.show{display:inline-flex;}
    .user-profile{display:flex;align-items:center;gap:12px;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.6);border:1px solid rgba(255,255,255,0.4);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);transition:border-color 0.2s ease,box-shadow .2s ease;cursor:pointer;position:relative;}
    .user-profile img{width:44px;height:44px;border-radius:50%;border:2px solid #fff;box-shadow:0 4px 16px rgba(0,0,0,0.08);object-fit:cover;}
    .user-profile strong{display:block;font-weight:200;color:var(--ink);}
    .user-profile span{font-size:0.85rem;color:var(--muted);}
    body.theme-dark .user-profile{background:rgba(15,23,42,0.4);border-color:rgba(255,255,255,0.15);box-shadow:0 10px 25px rgba(0,0,0,0.35);}
    body.theme-dark .user-profile strong{color:#fff;}
    body.theme-dark .user-profile span{color:rgba(255,255,255,0.8);}
    body.theme-mountain .user-profile{background:rgba(255,255,255,0.65);border-color:rgba(255,255,255,0.42);box-shadow:0 18px 34px rgba(17,22,26,0.2);}
    body.theme-mountain .user-profile strong{color:#fff;}
    body.theme-mountain .user-profile span{color:rgba(255,255,255,0.85);}

    header h1{
      font-family:var(--font-serif);
      font-weight:300;
      font-size:2rem;
      margin-bottom:1rem;
    }
    header p{font-weight:200;color:var(--muted);margin-bottom:2rem;}

    /* Wizard steps */
    .steps{
      display:flex;
      justify-content:space-between;
      align-items:center;
      max-width:700px;
      margin:0 auto 2.5rem;
      position:relative;
    }
    .step{
      text-align:center;
      flex:1;
      position:relative;
    }
    .step:not(:first-child)::before{
      content:"";
      position:absolute;
      top:14px;
      left:0;
      width:100%;
      height:2px;
      background:var(--line);
      z-index:0;
    }
    .circle{
      position:relative;
      z-index:1;
      width:28px;
      height:28px;
      border-radius:50%;
      background:#fff;
      border:2px solid var(--line);
      margin:0 auto 8px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:0.8rem;
    }
    .active .circle{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }
    .step span{font-size:0.85rem;color:var(--muted);}

    /* Form */
    .input-error{
      border-color:#c0392b !important;
      background:rgba(192,57,43,0.05);
    }
    button.input-error{
      border-color:#c0392b !important;
      box-shadow:0 0 0 1px rgba(192,57,43,0.2);
    }
    .field-error{
      color:#b91c1c;
      font-size:0.8rem;
      margin-top:6px;
    }

    form{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:2rem;
      max-width:800px;
      margin:0 auto;
      box-shadow:0 2px 6px rgba(0,0,0,0.03);
    }
    .field{margin-bottom:1.25rem;}
    .field label{
      display:block;
      margin-bottom:6px;
      font-size:0.9rem;
      color:var(--ink);
    }
    input,select,textarea{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:6px;
      font-family:inherit;
      font-size:0.9rem;
      transition:border-color .2s,box-shadow .2s;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(182,164,122,0.15);
      outline:none;
    }

    .actions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-top:1.5rem;
    }
    .step-panel form .actions{
      max-width:800px;
      margin-left:auto;
      margin-right:auto;
    }
    #create-step-review .actions{
      max-width:900px;
      margin:2rem auto 0;
    }
    .btn{
      border:none;
      border-radius:6px;
      padding:0.6rem 1.1rem;
      font-size:0.9rem;
      cursor:pointer;
      transition:all .2s;
    }
    .btn.secondary{background:#fff;border:1px solid var(--line);color:var(--ink);}
    .btn.secondary:hover{border-color:var(--accent);color:var(--accent);}
    .btn.primary{background:var(--accent);color:#fff;}
    .btn.primary:hover{background:#a0854d;}
    .comp-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  position: relative;
}

.dollar-sign {
  position: absolute;
  left: 12px;
  color: var(--muted);
  font-size: 0.9rem;
}

#comp {
  padding-left: 24px;
  width: 120px;
  border: 1px solid var(--line);
  border-radius: 6px;
  padding: 0.5rem 0.6rem 0.5rem 1.4rem;
  font-family: inherit;
  font-size: 0.9rem;
}

#comp:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(182,164,122,0.15);
  outline: none;
}

.comp-type {
  display: flex;
  gap: 6px;
}

.type-btn {
  background: #fff;
  border: 1px solid var(--line);
  border-radius: 6px;
  padding: 0.4rem 0.8rem;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.2s;
}

.type-btn.active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.type-btn:hover:not(.active) {
  border-color: var(--accent);
  color: var(--accent);
}
.select-field .select-wrapper {
  position: relative;
}
.select-field select {
  width: 100%;
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 0.65rem 2.6rem 0.65rem 0.85rem;
  font-size: 0.95rem;
  font-family: inherit;
  background: #fff;
  appearance: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}
.select-field select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(182,164,122,0.18);
  outline: none;
}
.select-field .select-arrow {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: var(--muted);
  font-size: 0.8rem;
}
.select-field .select-wrapper {
  position: relative;
}
.select-field select {
  width: 100%;
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 0.65rem 2.8rem 0.65rem 0.9rem;
  font-size: 0.95rem;
  font-family: inherit;
  background: #fff;
  appearance: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}
.select-field select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(182,164,122,0.18);
  outline: none;
}
.select-field .select-arrow {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: var(--muted);
  font-size: 0.8rem;
}
.steps a {
  text-decoration: none;
  color: inherit;
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.steps a:hover .circle {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.steps a:hover span {
  color: var(--accent);
}

    .step-panel[hidden] {
      display: none !important;
    }

    .form-wrapper{
      display:grid;
      grid-template-columns:1fr 260px;
      gap:2rem;
      max-width:1000px;
      margin:0 auto;
    }

    .tips{
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:1.5rem;
      background:var(--panel);
      font-size:0.9rem;
      color:var(--muted);
    }
    .tips h3{
      font-family:var(--font-serif);
      font-size:1.15rem;
      font-weight:300;
      margin-bottom:0.75rem;
      color:var(--ink);
    }
    .tips ul{
      margin:0 0 0.75rem 1.1rem;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:0.35rem;
    }

    .case-title-preview{
      border:1px solid rgba(182,164,122,0.4);
      border-radius:var(--radius);
      background:#fffbe8;
      padding:1rem 1.2rem;
      margin-bottom:1rem;
      font-size:0.95rem;
    }

    .char-count{
      text-align:right;
      font-size:0.8rem;
      color:var(--muted);
      margin-top:6px;
    }

    .summary{
      max-width:900px;
      margin:0 auto;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:2rem;
      box-shadow:0 2px 6px rgba(0,0,0,0.03);
    }
    .summary h2{
      font-family:'Sarabun',sans-serif;
      font-weight:300;
      font-size:1.5rem;
      margin-bottom:1rem;
    }
    .summary p{margin:0.25rem 0;color:var(--ink);}
    .summary small{color:var(--muted);}
    .auto-note{margin-top:1rem;font-size:0.9rem;color:var(--muted);}
    .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:2rem;}
    .btn{border:none;border-radius:6px;padding:0.6rem 1.1rem;font-size:0.9rem;cursor:pointer;transition:all .2s;}
    .btn.secondary{background:#fff;border:1px solid var(--line);color:var(--ink);}
    .btn.secondary:hover{border-color:var(--accent);color:var(--accent);}
    .btn.primary{background:var(--accent);color:#fff;}
    .btn.primary:hover{background:#a0854d;}

    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.35);
      backdrop-filter:blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:80;
    }
    .modal.active{display:flex;}
    .modal-content{
      background:#fff;
      width:min(700px,90vw);
      border-radius:18px;
      padding:2.5rem 2.75rem;
      box-shadow:0 15px 50px rgba(0,0,0,0.15);
      border:1px solid #e9e6df;
      font-family:'Sarabun',sans-serif;
      color:var(--ink);
      line-height:1.6;
    }
    .modal-content h3{
      font-family:'Cormorant Garamond',serif;
      font-weight:300;
      font-size:1.9rem;
      color:#1a1a1a;
      margin-bottom:2rem;
      text-align:center;
      letter-spacing:0.3px;
    }
    .modal-content hr{
      border:none;
      border-top:1px solid #e0ded8;
      margin:1.5rem 0;
    }
    .modal-content p{
      margin:0.35rem 0;
      color:#2a2a2a;
      font-size:0.95rem;
      display:flex;
      align-items:baseline;
      gap:6px;
    }
    .modal-content strong{
      font-family:'Cormorant Garamond',serif;
      font-weight:300;
      font-size:1rem;
      color:#111;
      min-width:130px;
      display:inline-block;
    }
    .close-btn{
      display:block;
      margin:2rem auto 0;
      background:#faf9f6;
      border:1px solid #d8d3c9;
      padding:0.55rem 1.2rem;
      border-radius:8px;
      font-size:0.9rem;
      cursor:pointer;
      color:#333;
      transition:all 0.2s ease;
      font-family:'Cormorant Garamond',serif;
    }
    .close-btn:hover{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }
    body.modal-open{overflow:hidden;}
    .toast.inline-toast{
      position:fixed;
      bottom:-120px;
      right:32px;
      max-width:320px;
      background:rgba(182,164,122,0.95);
      color:#fff;
      padding:0.85rem 1.1rem;
      border-radius:10px;
      font-size:0.9rem;
      box-shadow:0 4px 18px rgba(0,0,0,0.18);
      gap:0.65rem;
      display:flex;
      align-items:center;
      transition:bottom .35s ease;
      z-index:85;
    }
    .toast.inline-toast.show{bottom:34px;}
    .toast.inline-toast.error{background:#c0392b;}
    .toast.inline-toast a{color:#fff;text-decoration:underline;margin-left:10px;}

  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">Dashboard</div>
    <nav>
      <a href="dashboard-attorney.html">Home</a>
      <a href="active-cases.html">Cases &amp; Files</a>
      <a href="billing-attorney.html">Escrow</a>
      <a href="help.html">Help</a>
    </nav>
    <button type="button" class="sidebar-link" id="logoutBtn">Log Out</button>
    <div class="sidebar-footer"><a href="index.html" style="color:inherit;text-decoration:none;">© Let’s-ParaConnect 2025</a></div>
  </aside>

  <!-- Main -->
  <main class="main">
    <div class="topbar" data-attorney-header></div>

    <section class="step-panel" data-step="details" id="create-step-details">
      <header>
        <h1>Create a New Case</h1>
        <p>Provide details to post your case and invite paralegals to apply.</p>
      </header>

      <div class="steps">
        <a href="#details" class="step active" data-step-link="details">
          <div class="circle">1</div><span>Case details</span>
        </a>
        <a href="#description" class="step" data-step-link="description">
          <div class="circle">2</div><span>Description</span>
        </a>
        <a href="#review" class="step" data-step-link="review">
          <div class="circle">3</div><span>Review &amp; Post</span>
        </a>
      </div>

      <form>
        <div class="field">
          <label for="caseTitleInput">Case Title</label>
          <input id="caseTitleInput" type="text" placeholder="e.g., Draft asset purchase agreement" />
        </div>
      <div class="field">
        <label for="specialty">Field of Law</label>
        <select id="specialty">
              <option value="">Select…</option>
    <option>Administrative Law</option>
    <option>Admiralty & Maritime Law</option>
    <option>Antitrust Law</option>
    <option>Appellate Law</option>
    <option>Banking Law</option>
    <option>Bankruptcy Law</option>
    <option>Business / Corporate Law</option>
    <option>Civil Rights Law</option>
    <option>Class Action Law</option>
    <option>Commercial Law</option>
    <option>Communications Law</option>
    <option>Construction Law</option>
    <option>Consumer Protection Law</option>
    <option>Contract Law</option>
    <option>Criminal Defense Law</option>
    <option>Education Law</option>
    <option>Elder Law</option>
    <option>Election Law</option>
    <option>Employment & Labor Law</option>
    <option>Energy Law</option>
    <option>Entertainment Law</option>
    <option>Environmental Law</option>
    <option>Estate Planning & Probate</option>
    <option>Family Law</option>
    <option>Franchise Law</option>
    <option>Government Contracts Law</option>
    <option>Health Care Law</option>
    <option>Immigration Law</option>
    <option>Insurance Law</option>
    <option>Intellectual Property (IP) Law</option>
    <option>International Law</option>
    <option>Land Use & Zoning Law</option>
    <option>Litigation</option>
    <option>Media Law</option>
    <option>Medical Malpractice</option>
    <option>Military Law</option>
    <option>Municipal Law</option>
    <option>Personal Injury Law</option>
    <option>Product Liability Law</option>
    <option>Real Estate Law</option>
    <option>Securities Law</option>
    <option>Social Security / Disability Law</option>
    <option>Sports Law</option>
    <option>Tax Law</option>
    <option>Technology Law</option>
    <option>Telecommunications Law</option>
    <option>Torts</option>
    <option>Transportation Law</option>
    <option>Trusts & Estates</option>
    <option>White Collar Crime</option>
    <option>Workers’ Compensation</option>
  </select>
</div>

      <div class="field">
  <label for="state">Location (State)</label>
  <select id="state">
    <option value="">Select…</option>
    <option>Alabama</option>
    <option>Alaska</option>
    <option>Arizona</option>
    <option>Arkansas</option>
    <option>California</option>
    <option>Colorado</option>
    <option>Connecticut</option>
    <option>Delaware</option>
    <option>District of Columbia</option>
    <option>Florida</option>
    <option>Georgia</option>
    <option>Hawaii</option>
    <option>Idaho</option>
    <option>Illinois</option>
    <option>Indiana</option>
    <option>Iowa</option>
    <option>Kansas</option>
    <option>Kentucky</option>
    <option>Louisiana</option>
    <option>Maine</option>
    <option>Maryland</option>
    <option>Massachusetts</option>
    <option>Michigan</option>
    <option>Minnesota</option>
    <option>Mississippi</option>
    <option>Missouri</option>
    <option>Montana</option>
    <option>Nebraska</option>
    <option>Nevada</option>
    <option>New Hampshire</option>
    <option>New Jersey</option>
    <option>New Mexico</option>
    <option>New York</option>
    <option>North Carolina</option>
    <option>North Dakota</option>
    <option>Ohio</option>
    <option>Oklahoma</option>
    <option>Oregon</option>
    <option>Pennsylvania</option>
    <option>Rhode Island</option>
    <option>South Carolina</option>
    <option>South Dakota</option>
    <option>Tennessee</option>
    <option>Texas</option>
    <option>Utah</option>
    <option>Vermont</option>
    <option>Virginia</option>
    <option>Washington</option>
    <option>West Virginia</option>
    <option>Wisconsin</option>
    <option>Wyoming</option>
  </select>
</div>

      <div class="field">
  <label for="comp">Compensation</label>
  <div class="comp-wrapper">
    <span class="dollar-sign">$</span>
    <input id="comp" type="number" min="0" placeholder="Amount" />
  </div>
</div>

      <div class="field select-field">
        <label for="experience">Preferred Experience (Optional)</label>
        <div class="select-wrapper">
          <select id="experience">
            <option value="">No preference</option>
            <option value="1–3 years (Early Career)">1–3 years (Early Career)</option>
            <option value="3–7 years (Intermediate)">3–7 years (Intermediate)</option>
            <option value="7–12 years (Experienced)">7–12 years (Experienced)</option>
            <option value="12+ years (Advanced)">12+ years (Advanced)</option>
          </select>
          <span class="select-arrow">▾</span>
        </div>
      </div>

        <div class="actions">
          <button type="button" class="btn secondary" data-nav="cancel" data-target="dashboard-attorney.html">Cancel</button>
          <button type="button" class="btn primary" data-step-switch="description" id="detailsNextBtn">Next Step</button>
        </div>
      </form>
    </section>

    <section class="step-panel" data-step="description" id="create-step-description" hidden>
      <header>
        <h1>Create a New Case</h1>
        <p>Step 2: Add a detailed description for your case posting.</p>
      </header>

      <div class="steps">
        <a href="#details" class="step" data-step-link="details">
          <div class="circle">1</div><span>Case details</span>
        </a>
        <a href="#description" class="step active" data-step-link="description">
          <div class="circle">2</div><span>Description</span>
        </a>
        <a href="#review" class="step" data-step-link="review">
          <div class="circle">3</div><span>Review &amp; Post</span>
        </a>
      </div>

      <div class="form-wrapper">
        <form>
          <div class="case-title-preview" id="caseTitlePreview">
            <strong>Case Title:</strong> <span id="caseTitlePreviewText">Untitled Case</span>
          </div>
          <div class="field">
            <label for="caseDescription">Case Description</label>
            <textarea id="caseDescription" placeholder="Describe your case, goals, and expectations for the paralegal..."></textarea>
            <div class="char-count" id="descriptionCharCount">0 / 4000</div>
          </div>

          <div class="actions">
            <button type="button" class="btn secondary" data-step-switch="details">Back</button>
            <button type="button" class="btn secondary" data-nav="cancel" data-target="dashboard-attorney.html">Save and Exit</button>
            <button type="button" class="btn primary" data-step-switch="review">Next Step</button>
          </div>
        </form>

        <div class="tips">
          <h3>Tips for a Great Description</h3>
          <ul>
            <li>Be clear, well-written, and detailed about your case needs.</li>
            <li>Include the scope of work, deliverables, and deadlines.</li>
            <li>Avoid sensitive or identifying details in the posting.</li>
          </ul>
          <p>For examples of effective job descriptions, <a href="help.html">read our help article</a>.</p>
        </div>
      </div>
    </section>
    <section class="step-panel" data-step="review" id="create-step-review" hidden>
      <header>
        <h1>Review &amp; Post Your Case</h1>
        <p>Step 3: Confirm details before posting your case publicly.</p>
      </header>

      <div class="steps">
        <a href="#details" class="step" data-step-link="details">
          <div class="circle">1</div><span>Case details</span>
        </a>
        <a href="#description" class="step" data-step-link="description">
          <div class="circle">2</div><span>Description</span>
        </a>
        <a href="#review" class="step active" data-step-link="review">
          <div class="circle">3</div><span>Review &amp; Post</span>
        </a>
      </div>

      <section class="summary" id="reviewSummary">
        <p>Gathering your case details…</p>
      </section>

      <div class="actions">
        <button type="button" class="btn secondary" data-step-switch="description">Back</button>
        <button type="button" class="btn secondary" data-nav="cancel" data-target="dashboard-attorney.html">Save &amp; Exit</button>
        <button type="button" class="btn secondary" id="previewBtn">Preview Listing</button>
        <button type="button" class="btn primary" id="postBtn">Post Case</button>
      </div>
    </section>
  </main>
  <div id="toastBanner" class="toast" role="status" aria-live="polite"></div>
  <div class="modal" id="previewModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
      <h3 id="previewTitle"></h3>
      <p><strong>Field of Law:</strong> <span id="previewField">—</span></p>
      <p><strong>Location:</strong> <span id="previewState">—</span></p>
      <p><strong>Compensation:</strong> <span id="previewComp">—</span></p>
      <p><strong>Experience:</strong> <span id="previewExperience">—</span></p>
      <hr>
      <p id="previewDescription"></p>
      <p class="auto-note" id="previewAutoNote"></p>
      <button type="button" class="close-btn" id="closePreview">Close Preview</button>
    </div>
  </div>
  <div class="toast inline-toast" id="toast">
    ✅ Your case has been successfully posted.
    <a href="active-cases.html">View Posted Case</a>
  </div>
  <script src="assets/scripts/utils/toast.js"></script>
  <script>
    window.__ATTORNEY_PAGE__ = "create-case";
    window.__SKIP_NOTIFICATIONS__ = true;
  </script>
  <script type="module" src="assets/scripts/attorney-tabs.js"></script>

  <script>
  (function () {
    const stepPanels = new Map();
    document.querySelectorAll(".step-panel").forEach((panel) => {
      const key = panel.dataset.step;
      if (key) stepPanels.set(key, panel);
    });
    let currentStep = null;

    const fields = {
      title: document.getElementById("caseTitleInput"),
      specialty: document.getElementById("specialty"),
      state: document.getElementById("state"),
      comp: document.getElementById("comp"),
      experience: document.getElementById("experience"),
    };
    const titlePreview = document.getElementById("caseTitlePreviewText");
    const descriptionInput = document.getElementById("caseDescription");
    const descriptionCount = document.getElementById("descriptionCharCount");
    const toastHelper = window.toastUtils;
    const reviewSummary = document.getElementById("reviewSummary");
    const previewBtn = document.getElementById("previewBtn");
    const postBtn = document.getElementById("postBtn");
    const previewModal = document.getElementById("previewModal");
    const closePreviewBtn = document.getElementById("closePreview");
    const toastEl = document.getElementById("toast");
    const previewFields = {
      title: document.getElementById("previewTitle"),
      field: document.getElementById("previewField"),
      state: document.getElementById("previewState"),
      comp: document.getElementById("previewComp"),
      experience: document.getElementById("previewExperience"),
      description: document.getElementById("previewDescription"),
    };
    const previewAutoNote = document.getElementById("previewAutoNote");
    const autoNoteCopy = "Applicants automatically include their résumé, cover letter (if available), and LinkedIn profile.";
    let latestCaseData = null;
    let csrfToken = "";

    const validators = [
      {
        field: fields.title,
        check: (value) => value.trim().length >= 3,
        message: "Add a descriptive case title.",
      },
      {
        field: fields.specialty,
        check: (value) => Boolean(value.trim()),
        message: "Select the primary practice area.",
      },
      {
        field: fields.state,
        check: (value) => Boolean(value.trim()),
        message: "Select the state or jurisdiction.",
      },
      {
        field: fields.comp,
        check: (value) => Number(value) > 0,
        message: "Enter the compensation amount.",
      },
    ];

    function updateTitlePreview(value = "") {
      if (!titlePreview) return;
      const safe = value.trim();
      titlePreview.textContent = safe || "Untitled Case";
    }

    function updateDescriptionCount() {
      if (!descriptionInput || !descriptionCount) return;
      descriptionCount.textContent = `${descriptionInput.value.length} / 4000`;
    }

    function showStep(step, { updateHash = true } = {}) {
      if (!stepPanels.has(step)) return;
      stepPanels.forEach((panel, key) => {
        if (!panel) return;
        panel.hidden = key !== step;
      });
      currentStep = step;
      if (updateHash) {
        history.replaceState(null, "", `#${step}`);
      }
    }

    function attemptStepChange(targetStep) {
      if (!targetStep || targetStep === currentStep) return;
      if (targetStep === "description" && currentStep !== "description") {
        if (!validateDetails()) return;
        persistDraft();
      }
      if (targetStep === "review") {
        if (!ensureReviewReady()) return;
        persistDraft();
        hydrateReviewSummary();
      }
      showStep(targetStep);
    }

    document.querySelectorAll("[data-step-link]").forEach((link) => {
      link.addEventListener("click", (event) => {
        const target = link.dataset.stepLink;
        if (!target) return;
        event.preventDefault();
        attemptStepChange(target);
      });
    });
    document.querySelectorAll("[data-step-switch]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.stepSwitch;
        if (!target) return;
        attemptStepChange(target);
      });
    });

    const initialHash = (window.location.hash || "").replace("#", "");
    if (initialHash && stepPanels.has(initialHash)) {
      if (initialHash === "description") {
        showStep("details", { updateHash: false });
        attemptStepChange("description");
      } else if (initialHash === "review") {
        showStep("details", { updateHash: false });
        attemptStepChange("description");
        attemptStepChange("review");
      } else {
        showStep(initialHash, { updateHash: false });
      }
    } else {
      showStep("details", { updateHash: false });
    }

    window.addEventListener("hashchange", () => {
      const hashed = (window.location.hash || "").replace("#", "");
      if (!hashed || hashed === currentStep) return;
      if (!stepPanels.has(hashed)) return;
      if (hashed === "description" || hashed === "review") {
        attemptStepChange(hashed);
      } else {
        showStep(hashed, { updateHash: false });
      }
    });

    Object.entries(fields).forEach(([key, field]) => {
      if (!field) return;
      const eventName = field.tagName === "SELECT" ? "change" : "input";
      field.addEventListener(eventName, () => clearFieldError(field));
      const storageKeyCamel = `case${key.charAt(0).toUpperCase() + key.slice(1)}`;
      const storedValue = localStorage.getItem(storageKeyCamel) || localStorage.getItem(`case_${key}`) || "";
      if (storedValue && field.value !== storedValue) {
        field.value = storedValue;
      }
      if (key === "title") {
        updateTitlePreview(field.value || storedValue || "");
      }
      field.addEventListener(eventName, () => {
        const value = field.value || "";
        localStorage.setItem(storageKeyCamel, value);
        localStorage.setItem(`case_${key}`, value);
        if (key === "title") {
          updateTitlePreview(value);
        }
      });
    });

    if (descriptionInput) {
      const storedDescription = localStorage.getItem("caseDescription") || localStorage.getItem("case_description") || "";
      if (storedDescription) {
        descriptionInput.value = storedDescription;
      }
      updateDescriptionCount();
      descriptionInput.addEventListener("input", () => {
        localStorage.setItem("caseDescription", descriptionInput.value);
        localStorage.setItem("case_description", descriptionInput.value);
        updateDescriptionCount();
      });
    }

    function validateDetails() {
      let hasErrors = false;
      validators.forEach(({ field, check, message }) => {
        clearFieldError(field);
        if (!field) return;
        if (!check(field.value || "")) {
          showFieldError(field, message);
          hasErrors = true;
        }
      });
      if (hasErrors) {
        return false;
      }
      return true;
    }

    function persistDraft() {
      localStorage.setItem("caseTitle", fields.title?.value?.trim() || "");
      localStorage.setItem("caseSpecialty", fields.specialty?.value || "");
      localStorage.setItem("caseState", fields.state?.value || "");
      localStorage.setItem("caseComp", fields.comp?.value || "");
      localStorage.setItem("caseCompAmount", fields.comp?.value || "");
      localStorage.setItem("caseExperience", fields.experience?.value || "");
    }

    function showFieldError(field, message) {
      if (!field) return;
      clearFieldError(field);
      field.classList.add("input-error");
      field.setAttribute("aria-invalid", "true");
      const error = document.createElement("div");
      error.className = "field-error";
      error.textContent = message;
      const wrapper = field.closest(".field") || field.closest("[data-field-wrapper]");
      if (wrapper) wrapper.appendChild(error);
      else field.insertAdjacentElement("afterend", error);
    }

    function clearFieldError(field) {
      if (!field) return;
      field.classList.remove("input-error");
      field.removeAttribute("aria-invalid");
      const wrapper = field.closest(".field") || field.closest("[data-field-wrapper]");
      if (wrapper) {
        const existing = wrapper.querySelector(".field-error");
        if (existing) existing.remove();
        return;
      }
      const next = field.nextElementSibling;
      if (next?.classList.contains("field-error")) {
        next.remove();
      }
    }

    function getStoredValue(primaryKey, legacyKey) {
      return localStorage.getItem(primaryKey) || localStorage.getItem(legacyKey) || "";
    }

    function formatComp(amount) {
      if (!amount) return "—";
      const numeric = Number(amount);
      if (!Number.isFinite(numeric)) return `$${amount}`;
      return numeric.toLocaleString("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 });
    }

    function collectCaseData() {
      const title = (fields.title?.value || "").trim() || getStoredValue("caseTitle", "case_title");
      const field = fields.specialty?.value || getStoredValue("caseSpecialty", "case_specialty");
      const state = fields.state?.value || getStoredValue("caseState", "case_state");
      const compRaw = fields.comp?.value || getStoredValue("caseCompAmount", "case_comp_amount");
      const experience = fields.experience?.value || getStoredValue("caseExperience", "case_experience");
      const description = (descriptionInput?.value || "").trim() || getStoredValue("caseDescription", "case_description").trim();
      return {
        title: title || "",
        field: field || "",
        state: state || "",
        compAmount: compRaw || "",
        comp: formatComp(compRaw),
        experience: experience || "",
        description: description || "",
      };
    }

    function hasDescription() {
      if ((descriptionInput?.value || "").trim()) return true;
      return Boolean(getStoredValue("caseDescription", "case_description").trim());
    }

    function ensureReviewReady() {
      if (!validateDetails()) return false;
      if (!hasDescription()) {
        return false;
      }
      return true;
    }

    function hydrateReviewSummary() {
      if (!reviewSummary) return;
      const data = collectCaseData();
      latestCaseData = data;
      reviewSummary.innerHTML = `
        <h2>${data.title || "(Untitled Case)"}</h2>
        <p><small>${data.field || "Practice area pending"} • ${data.state || "Location pending"}</small></p>
        <p><strong>Compensation:</strong> ${data.comp}</p>
        <p><strong>Experience:</strong> ${data.experience || "Not specified"}</p>
        <hr>
        <p>${data.description || "No description provided yet."}</p>
        <p class="auto-note">${autoNoteCopy}</p>
      `;
    }

    function openPreviewModal() {
      if (!previewModal) return;
      const data = latestCaseData || collectCaseData();
      if (!data.title || !data.description) {
        showToastBanner("Add a case title and description before previewing.", "error");
        return;
      }
      previewFields.title && (previewFields.title.textContent = data.title);
      previewFields.field && (previewFields.field.textContent = data.field || "—");
      previewFields.state && (previewFields.state.textContent = data.state || "—");
      previewFields.comp && (previewFields.comp.textContent = data.comp || "—");
      previewFields.experience && (previewFields.experience.textContent = data.experience || "—");
      previewFields.description && (previewFields.description.textContent = data.description || "No description provided yet.");
      if (previewAutoNote) previewAutoNote.textContent = autoNoteCopy;
      previewModal.classList.add("active");
      document.body.classList.add("modal-open");
    }

    function closePreviewModal() {
      if (!previewModal) return;
      previewModal.classList.remove("active");
      document.body.classList.remove("modal-open");
    }

    function clearDraft() {
      [
        "caseTitle",
        "caseSpecialty",
        "caseState",
        "caseComp",
        "caseCompAmount",
        "caseExperience",
        "caseDescription",
      ].forEach((key) => localStorage.removeItem(key));
    }

    function showToast(message, href, isError = false) {
      if (!toastEl) return;
      const linkHtml = href ? ` <a href="${href}">View Case</a>` : "";
      toastEl.innerHTML = `${isError ? "⚠️" : "✅"} ${message}${linkHtml}`;
      toastEl.classList.toggle("error", Boolean(isError));
      toastEl.classList.add("show");
      setTimeout(() => toastEl.classList.remove("show"), 5000);
    }

    async function fetchCsrfToken() {
      if (csrfToken) return csrfToken;
      try {
        const res = await fetch("/api/csrf", { credentials: "include" });
        const json = await res.json().catch(() => ({}));
        csrfToken = json?.csrfToken || "";
      } catch (err) {
        console.warn("Unable to fetch CSRF token", err);
      }
      return csrfToken;
    }

    async function submitCase(payload) {
      const token = (window.getSessionToken && window.getSessionToken()) || "";
      if (!token) {
        window.checkSession?.("attorney");
        throw new Error("Please log in again before posting.");
      }
      await fetchCsrfToken();
      const res = await fetch("/api/cases", {
        method: "POST",
        credentials: "include",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
          "X-CSRF-Token": csrfToken || "",
          Accept: "application/json",
        },
        body: JSON.stringify(payload),
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) {
        throw new Error(data?.error || data?.msg || "Unable to post this case right now.");
      }
      return data;
    }

    function buildPayload(data) {
      const description = data.description || "Additional details will be provided once the case is accepted.";
      return {
        title: data.title,
        practiceArea: data.field,
        state: data.state,
        compensationAmount: data.compAmount,
        experience: data.experience,
        details: description,
      };
    }

    async function handlePost() {
      if (!ensureReviewReady()) {
        showToastBanner("Finish the required fields before posting.", "error");
        return;
      }
      const data = latestCaseData || collectCaseData();
      if (!data.title || !data.description) {
        showToastBanner("Add a case title and description before posting.", "error");
        return;
      }
      if (postBtn) postBtn.disabled = true;
      try {
        const created = await submitCase(buildPayload(data));
        clearDraft();
        const caseId = created?.id || created?._id;
        const href = caseId ? `case-detail.html?caseId=${encodeURIComponent(caseId)}` : "dashboard-attorney.html#cases";
        showToast("Your case has been successfully posted.", href);
      } catch (err) {
        console.error(err);
        showToast(err?.message || "Unable to post this case right now.", null, true);
        if (postBtn) postBtn.disabled = false;
      }
    }

    function showToastBanner(message, type = "info") {
      if (toastHelper?.show) {
        toastHelper.show(message, { targetId: "toastBanner", type });
      } else {
        alert(message);
      }
    }

    previewBtn?.addEventListener("click", openPreviewModal);
    closePreviewBtn?.addEventListener("click", closePreviewModal);
    previewModal?.addEventListener("click", (event) => {
      if (event.target === previewModal) closePreviewModal();
    });
    postBtn?.addEventListener("click", handlePost);
  })();
  </script>
<script>
const compInput = document.getElementById('comp');
if (compInput) {
  compInput.addEventListener('input', () => {
    localStorage.setItem('caseCompAmount', compInput.value);
  });
}
</script>
<script src="assets/scripts/create-case-nav.js"></script>
</body>
</html>
