<!DOCTYPE html>
<html lang="en">
<head>

  <link rel="stylesheet" href="assets/styles/fonts.css" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Case Files – Let’s-ParaConnect</title>
  <script src="assets/scripts/utils/session.js"></script>
  <style>
    .skip-link {
      position: absolute;
      left: 12px;
      top: -40px;
      background: #1a2230;
      color: #ffffff;
      padding: 8px 12px;
      border-radius: 6px;
      text-decoration: none;
      z-index: 10000;
      font-size: 14px;
    }

    .skip-link:focus {
      top: 12px;
    }

    .gold{color:#b4975a;}
    :root {
      --bg:#fff;
      --accent:#b6a47a;
      --line:rgba(0,0,0,0.08);
      --muted:#8a8a8a;
      --ink:#1a1a1a;
      --panel:#fcfcfc;
      --sidebar-text:#1a1a1a;
      --sidebar-bg:#f5f5f5e6;
      --font-serif:'Cormorant Garamond',serif;
      --font-sans:'Sarabun',sans-serif;
      --radius:12px;
    }

    body.theme-dark {
      --bg:#0f172a;
      --panel:#151b29;
      --ink:#f5f6fb;
      --muted:#9aa7c4;
      --line:rgba(255,255,255,0.08);
      --sidebar-text:#f8fbff;
      --sidebar-bg:#1c2333;
    }

    body.theme-mountain {
      --bg:#f8f6f1;
      --panel:#ffffff;
      --muted:#7a736a;
      --sidebar-text:#ffffff;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:var(--font-sans);
      background:var(--bg);
      color:var(--ink);
      margin:0;
      display:flex;
      min-height:100vh;
      overflow:hidden;
    }

    .role-shell{
      display:flex;
      min-height:100vh;
      width:100%;
    }

    .sidebar{
      width:240px;
      background:var(--sidebar-bg);
      display:flex;
      flex-direction:column;
      border-right:1px solid var(--line);
      padding:24px 16px;
      color:var(--sidebar-text);
      position:sticky;
      top:0;
      height:100vh;
      overflow-y:auto;
      position:relative;
    }
    .sidebar::before{
      content:"";
      position:absolute;
      inset:0;
      background:transparent;
      pointer-events:none;
      transition:background .3s ease;
    }
    .logo{font-family:var(--font-serif);font-size:1.6rem;text-align:center;margin-bottom:36px;}
    nav{display:flex;flex-direction:column;gap:14px;}
    nav a{text-decoration:none;color:var(--sidebar-text);font-weight:300;font-size:.95rem;padding:10px 14px;border-radius:8px;transition:background .3s;}
    nav a.active,nav a:hover{background:rgba(0,0,0,0.04);}
    body.theme-dark nav a.active, body.theme-dark nav a:hover{background:rgba(255,255,255,0.12);}
    body.theme-mountain nav a,
    body.theme-mountain-dark nav a{color:#fff;}
    body.theme-mountain nav a.active,body.theme-mountain nav a:hover,
    body.theme-mountain-dark nav a.active,body.theme-mountain-dark nav a:hover{background:rgba(255,255,255,0.18);}
    .sidebar-footer{font-size:.7rem;color:var(--muted);text-align:center;}
    .sidebar-toggle{
      display:none;
      align-items:center;
      justify-content:center;
      width:42px;
      height:42px;
      border-radius:12px;
      border:none;
      background:transparent;
      padding:0;
      cursor:pointer;
      position:fixed;
      top:14px;
      left:14px;
      z-index:2100;
    }
    .sidebar-toggle-icon{
      width:28px;
      height:28px;
      display:block;
    }
    .sidebar-backdrop{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.35);
      z-index:1900;
    }
    body.theme-mountain .sidebar,
    body.theme-mountain-dark .sidebar{background:url('hero-mountain.jpg') center/cover no-repeat;}
    body.theme-mountain .sidebar::before,
    body.theme-mountain-dark .sidebar::before{background:rgba(0,0,0,0.45);}
    body.theme-mountain .sidebar > *,
    body.theme-mountain-dark .sidebar > *{position:relative;z-index:1;}
    .main{flex:1;padding:40px;overflow-y:auto;background:var(--bg);}
    .topbar{display:flex;justify-content:flex-end;margin-bottom:1.5rem;}
    .notification-icon{
      width:46px;
      height:46px;
      border-radius:50%;
      border:1px solid var(--line);
      display:flex;
      justify-content:center;
      align-items:center;
      background:var(--panel);
      cursor:pointer;
      position:relative;
      transition:border-color .2s ease, transform .2s ease;
    }
    .notification-icon:hover{border-color:var(--accent);transform:translateY(-1px);}
    .notification-icon svg{width:22px;height:22px;color:var(--ink);}
    .notification-badge{
      position:absolute;
      top:-4px;
      right:-4px;
      background:#c0392b;
      color:#fff;
      font-size:.75rem;
      border-radius:999px;
      padding:2px 6px;
      line-height:1;
      display:none;
      font-weight:600;
    }
    .notification-badge.show{display:inline-flex;}
    header h1{font-family:var(--font-serif);font-weight:300;font-size:2rem;margin-bottom:.25rem;}
    header p{color:var(--muted);margin-bottom:2rem;font-size:.95rem;}
    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      margin-bottom:2rem;
    }

    .filters{display:flex;gap:.75rem;margin-bottom:1.5rem;flex-wrap:wrap;}
    .filters button{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:8px;
      padding:.5rem 1rem;
      cursor:pointer;
      font-size:.9rem;
      transition:all .2s ease;
      color:var(--ink);
    }
    .filters button.active{background:var(--accent);color:#fff;border-color:var(--accent);}
    .filters button:hover{border-color:var(--accent);}
    .case-switcher{
      display:flex;
      flex-wrap:wrap;
      gap:0.6rem;
      margin:1.5rem 0 1rem;
    }
    .case-switcher a{
      text-decoration:none;
      border:1px solid var(--line);
      border-radius:999px;
      padding:0.4rem 1.1rem;
      font-size:0.9rem;
      color:var(--ink);
      background:var(--panel);
      transition:background 0.2s ease,color 0.2s ease,border-color 0.2s ease;
    }
    .case-switcher a.active{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }

    .case-files{display:flex;flex-direction:column;gap:1rem;}
    .file-card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:var(--panel);
      padding:1rem 1.25rem;
      display:flex;
      flex-direction:column;
      gap:.6rem;
    }
    .file-line{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
    }
    .file-name{
      font-family:var(--font-serif);
      font-size:1.05rem;
      word-break:break-word;
    }
    .file-status{
      font-size:.85rem;
      font-weight:600;
      color:var(--accent);
      text-transform:capitalize;
    }
    .case-files-empty{
      padding:16px;
      color:var(--muted);
      font-size:.95rem;
    }
    .file-meta{
      display:flex;
      gap:1rem;
      font-size:.85rem;
      color:var(--muted);
      flex-wrap:wrap;
    }
    .file-actions{
      display:flex;
      gap:.75rem;
    }
    .btn-link{
      color:var(--accent);
      text-decoration:none;
      font-size:.9rem;
      font-weight:600;
    }
    .btn-link:hover{text-decoration:underline;}
    .info-banner{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:var(--panel);
      padding:1rem 1.25rem;
      margin-bottom:1.25rem;
      font-size:0.95rem;
    }
    .info-banner strong{font-family:var(--font-serif);font-weight:400;}
    .info-banner a{color:var(--accent);}

    @media (max-width: 1024px){
      body{
        flex-direction:column;
      }
      .role-shell{
        flex-direction:column;
        min-height:100vh;
      }
      .sidebar{
        position:fixed;
        top:0;
        left:0;
        width:260px;
        height:100vh;
        border-right:none;
        padding-top:72px;
        transform:translateX(-110%);
        transition:transform .25s ease;
        z-index:2000;
        box-shadow:18px 0 40px rgba(0,0,0,0.18);
      }
      body.nav-open .sidebar{
        transform:translateX(0);
      }
      body.nav-open .sidebar-backdrop{
        display:block;
      }
      .sidebar-toggle{
        display:inline-flex;
      }
      .main{padding:28px 20px 60px;}
      .main{
        max-width:100%;
        overflow-x:hidden;
      }
      img,
      svg,
      video,
      iframe,
      table{
        max-width:100%;
        height:auto;
      }
      .case-card,
      .case-subinfo,
      .filters,
      .case-switcher,
      .info-banner{
        min-width:0;
        overflow-wrap:anywhere;
        word-break:break-word;
      }
    }

    .sidebar-link{
      margin-top:1.5rem;
      width:100%;
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:0.6rem 1rem;
      background:transparent;
      color:var(--sidebar-text);
      font-size:0.9rem;
      font-family:var(--font-sans);
      cursor:pointer;
      transition:background .2s ease,color .2s ease;
    }
    .sidebar-link:hover,
    .sidebar-link:focus{
      background:rgba(0,0,0,0.05);
      color:var(--accent);
      outline:none;
    }
    body.theme-dark .sidebar-link:hover,
    body.theme-dark .sidebar-link:focus,
    body.theme-mountain .sidebar-link:hover,
    body.theme-mountain .sidebar-link:focus,
    body.theme-mountain-dark .sidebar-link:hover,
    body.theme-mountain-dark .sidebar-link:focus{
      color:#fff;
      background:rgba(255,255,255,0.12);
    }
    body.theme-mountain .sidebar-link,
    body.theme-mountain-dark .sidebar-link{color:#fff;}
    .sidebar-bottom{
      margin-top:auto;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .hidden{
      display:none !important;
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>
  <button class="sidebar-toggle" id="sidebarToggle" type="button" aria-label="Open menu" aria-expanded="false">
    <img class="sidebar-toggle-icon" src="sidebar-4.png" alt="" aria-hidden="true" />
  </button>
  <div class="sidebar-backdrop" id="sidebarBackdrop" aria-hidden="true"></div>
  <div id="paralegalCaseFiles" class="role-shell hidden">
    <aside class="sidebar" id="paralegalSidebar">
      <div class="logo">Dashboard</div>
      <nav>
        <a href="dashboard-paralegal.html">Home</a>
        <a href="case-files.html" class="active">Active Cases</a>
        <a href="profile-settings.html">Profile Settings</a>
        <a href="help.html">Help</a>
      </nav>
      <div class="sidebar-bottom">
        <button type="button" class="sidebar-link" id="logoutBtn">Log Out</button>
        <div class="sidebar-footer"><a href="index.html" style="color:inherit;text-decoration:none;">© Let’s-ParaConnect 2025</a></div>
      </div>
    </aside>

    <main class="main" tabindex="-1" data-main>
      <div class="topbar" data-attorney-header></div>
      <header class="page-header">
        <div>
          <h1>Case Files</h1>
          <p>View and manage all files associated with your cases. You can filter by approval status and download or print any document.</p>
        </div>
      </header>

      <div class="filters">
        <button type="button" id="filterAll" class="active">All</button>
        <button type="button" id="filterApproved">Approved</button>
        <button type="button" id="filterPending">Pending Review</button>
        <button type="button" id="filterRevisions">Requested Revisions</button>
      </div>

      <div class="case-files" id="filesContainer"></div>
    </main>
  </div>

  <div id="attorneyCaseFiles" class="role-shell hidden">
    <aside class="sidebar" id="attorneySidebar">
      <div class="logo">Dashboard</div>
      <nav>
        <a href="dashboard-attorney.html">Home</a>
        <a href="dashboard-attorney.html#cases" class="active">Cases &amp; Files</a>
        <a href="dashboard-attorney.html#billing">Escrow</a>
        <a href="help.html">Help</a>
      </nav>
      <div class="sidebar-bottom">
        <button type="button" class="sidebar-link" id="attorneyLogoutBtn">Log Out</button>
        <div class="sidebar-footer"><a href="index.html" style="color:inherit;text-decoration:none;">© Let’s-ParaConnect 2025</a></div>
      </div>
    </aside>

    <main class="main" tabindex="-1" data-main>
      <div class="topbar" data-attorney-header></div>
      <div class="info-banner">
        <strong>Looking for Case Files?</strong> Manage uploads, downloads, and approvals from the unified
        <a href="dashboard-attorney.html#cases">Cases &amp; Files</a> dashboard. This legacy view will remain read-only.
      </div>
      <header class="page-header">
        <div>
          <h1>Paralegal Revisions</h1>
          <p>Oversee your paralegal’s work. Approve submissions, request revisions, or download final files.</p>
        </div>
      </header>
      <div class="case-switcher" role="tablist" aria-label="Case views">
        <a href="dashboard-attorney.html#cases" role="tab" aria-selected="false">Cases</a>
        <a href="case-files.html" class="active" role="tab" aria-selected="true">Case Files</a>
      </div>

      <div class="filters">
        <button type="button" id="attorneyFilterAll" class="active">All Files</button>
        <button type="button" id="attorneyFilterApproved">Approved</button>
        <button type="button" id="attorneyFilterPending">Awaiting Your Review</button>
        <button type="button" id="attorneyFilterRevisions">Revisions Requested</button>
      </div>

      <div class="case-files" id="attorneyFilesContainer"></div>
    </main>
  </div>

  <script>
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = 'index.html';
      });
    }
    const attorneyLogoutBtn = document.getElementById('attorneyLogoutBtn');
    if (attorneyLogoutBtn) {
      attorneyLogoutBtn.addEventListener('click', () => {
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = 'index.html';
      });
    }
  </script>
  <script>
    window.__ATTORNEY_PAGE__ = "case-files";
    window.__TAB_ROLE__ = "attorney,paralegal";
  </script>
  <script src="assets/scripts/utils/toast.js"></script>
  <script type="module" src="assets/scripts/utils/notifications.js"></script>
  <script type="module" src="assets/scripts/attorney-tabs.js"></script>
  <script type="module">
    import { initCaseFilesView } from "./assets/scripts/case-files-view.js";

    const paralegalShell = document.getElementById("paralegalCaseFiles");
    const attorneyShell = document.getElementById("attorneyCaseFiles");
    const mainTargets = document.querySelectorAll("[data-main]");

    function setActiveMain(shell) {
      mainTargets.forEach((el) => el.removeAttribute("id"));
      const mainEl = shell?.querySelector("[data-main]");
      if (mainEl) {
        mainEl.id = "main";
      }
    }

    function setShellHidden(shell, hidden) {
      if (!shell) return;
      shell.classList.toggle("hidden", hidden);
      shell.setAttribute("aria-hidden", hidden ? "true" : "false");
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const role = await resolveRole();
      setShellHidden(paralegalShell, true);
      setShellHidden(attorneyShell, true);
      if (role === "paralegal") {
        setShellHidden(paralegalShell, false);
        setActiveMain(paralegalShell);
        await initCaseFilesView({
          containerId: "filesContainer",
          filters: [
            { id: "filterAll", fn: (files) => files },
            { id: "filterApproved", fn: (files) => files.filter((f) => f.status === "approved") },
            { id: "filterPending", fn: (files) => files.filter((f) => f.status === "pending_review") },
            { id: "filterRevisions", fn: (files) => files.filter((f) => f.status === "attorney_revision") },
          ],
          emptyCopy: "No files found.",
          gatedCopy: "No funded cases yet.",
          unauthorizedCopy: "You need a paralegal account to view these files.",
        });
      } else {
        setShellHidden(attorneyShell, false);
        setActiveMain(attorneyShell);
        await initCaseFilesView({
          containerId: "attorneyFilesContainer",
          filters: [
            { id: "attorneyFilterAll", fn: (files) => files },
            { id: "attorneyFilterApproved", fn: (files) => files.filter((f) => f.status === "approved") },
            { id: "attorneyFilterPending", fn: (files) => files.filter((f) => f.status === "pending_review") },
            { id: "attorneyFilterRevisions", fn: (files) => files.filter((f) => f.status === "attorney_revision") },
          ],
          emptyCopy: "Awaiting paralegal submissions.",
          emptySubtext: "Once your paralegal uploads a file, you’ll be able to review it here.",
          gatedCopy: "Fund a case to unlock file review.",
          unauthorizedCopy: "You need an attorney account to view these files.",
        });
      }
    });

    async function resolveRole() {
      try {
        const session = await window.checkSession?.(undefined, { redirectOnFail: false });
        return String(session?.user?.role || session?.role || "attorney").toLowerCase();
      } catch {
        return "attorney";
      }
    }
  </script>
  <script>
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarBackdrop = document.getElementById('sidebarBackdrop');
    const getActiveSidebar = () => document.querySelector('.role-shell:not(.hidden) .sidebar');
    const syncControls = () => {
      const sidebar = getActiveSidebar();
      if (sidebarToggle && sidebar?.id) {
        sidebarToggle.setAttribute('aria-controls', sidebar.id);
      }
    };
    const closeSidebar = () => {
      document.body.classList.remove('nav-open');
      if (sidebarToggle) sidebarToggle.setAttribute('aria-expanded', 'false');
    };
    const openSidebar = () => {
      syncControls();
      document.body.classList.add('nav-open');
      if (sidebarToggle) sidebarToggle.setAttribute('aria-expanded', 'true');
    };
    if (sidebarToggle) {
      sidebarToggle.addEventListener('click', () => {
        if (document.body.classList.contains('nav-open')) closeSidebar();
        else openSidebar();
      });
    }
    if (sidebarBackdrop) {
      sidebarBackdrop.addEventListener('click', closeSidebar);
    }
    document.addEventListener('click', (event) => {
      const sidebar = getActiveSidebar();
      if (!sidebar) return;
      if (event.target && event.target.tagName === 'A' && sidebar.contains(event.target)) {
        closeSidebar();
      }
    });
    window.addEventListener('resize', () => {
      if (window.innerWidth > 960) closeSidebar();
    });
    document.addEventListener('DOMContentLoaded', () => {
      syncControls();
      setTimeout(syncControls, 600);
    });
  </script>
</body>
</html>
